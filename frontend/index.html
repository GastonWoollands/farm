<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f766e">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="logo.jpg" sizes="192x192">
  <link rel="apple-touch-icon" href="logo.jpg">
  <link rel="stylesheet" href="styles.css">
  <title>LiveStock</title>
  <script defer src="/_vercel/insights/script.js"></script>
  <script defer src="/_vercel/speed-insights/script.js"></script>
  <!-- Configuration -->
  <script src="config.js"></script>
  
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    
    // Use config from config.js
    const firebaseConfig = window.FIREBASE_CONFIG;
    
    if (!firebaseConfig || !firebaseConfig.apiKey || firebaseConfig.apiKey === 'your-actual-api-key-here') {
      console.error('Firebase configuration not set. Please update config.js with your Firebase project details.');
      document.body.innerHTML = '<div style="text-align:center; padding:2rem; color:#c33;"><h2>Configuration Required</h2><p>Please update config.js with your Firebase project details.</p></div>';
    } else {
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      window.firebaseAuth = auth;
    }
  </script>
</head>
<body>
  <header class="app-header">
    <!-- Top-right status (absolute positioned) -->
    <div class="header-status">
      <span class="badge" id="status-badge">Offline</span>
      <button id="signout-btn" class="btn signout-btn" style="display:none;">Cerrar Sesión</button>
    </div>
    
    <!-- Centered content -->
    <div class="header-center">
      <h1>LiveStock <small id="pending-count" class="muted" style="font-size:12px; margin-left:8px;"></small></h1>
      <div id="company-info" class="company-info" style="display:none;">
        <span id="current-company-name">Personal Data</span>
        <select id="company-switcher" class="company-switcher" style="display:none;">
          <!-- Company options will be populated by JavaScript -->
        </select>
      </div>
    </div>
  </header>

  <main class="container" id="auth-screen" hidden>
    <section class="card" style="max-width:400px; margin:2rem auto;">
      <div style="text-align:center; margin-bottom:2rem;">
        <h2 style="margin:0 0 0.5rem 0; color:#0f766e;">LiveStock</h2>
        <p class="muted">Inicia sesión para continuar</p>
      </div>
      
      <form id="auth-form">
        <div class="form-field">
          <input id="auth-email" name="email" type="email" placeholder="Email" required autocomplete="email" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:6px; font-size:16px;">
        </div>
        <div class="form-field">
          <input id="auth-password" name="password" type="password" placeholder="Contraseña" autocomplete="current-password" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:6px; font-size:16px;">
        </div>
        
        <button type="submit" class="btn primary" id="signin-btn" style="width:100%; padding:12px; margin:8px 0; font-size:16px; background:#0f766e; border:none; border-radius:6px; color:white; cursor:pointer;">
          Iniciar Sesión
        </button>
        
        <div style="text-align:center; margin:1rem 0;">
          <span class="muted">¿No tienes cuenta? </span>
          <button type="button" class="btn" id="signup-btn" style="background:none; border:none; color:#0f766e; text-decoration:underline; cursor:pointer; font-size:14px;">
            Regístrate aquí
          </button>
        </div>
        
        <div style="text-align:center; margin:0.5rem 0;">
          <button type="button" class="btn" id="forgot-password-btn" style="background:none; border:none; color:#666; text-decoration:underline; cursor:pointer; font-size:13px;">
            ¿Olvidaste tu contraseña?
          </button>
        </div>
        
        <div style="text-align:center; margin:0.5rem 0;" id="back-to-login-section" hidden>
          <button type="button" class="btn" id="back-to-login-btn" style="background:none; border:none; color:#0f766e; text-decoration:underline; cursor:pointer; font-size:13px;">
            ← Volver al inicio de sesión
          </button>
        </div>
        
        <div id="auth-message" style="text-align:center; margin:1rem 0; padding:8px; border-radius:4px;" hidden></div>
      </form>
    </section>
  </main>

  <main class="container" id="app-screen" hidden>
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button id="metrics-tab" class="nav-tab active">Métricas</button>
      <button id="cows-tab" class="nav-tab">Animales</button>
      <!-- <button id="pigs-tab" class="nav-tab">Cerdos</button> -->
      <button id="search-tab" class="nav-tab">Buscar</button>
      <button id="objectives-tab" class="nav-tab">Configuración</button>
    </div>

    <!-- Metrics Page -->
    <div id="metrics-page">
      <div id="metrics-container"></div>
    </div>

    <!-- Animals Page -->
    <div id="cows-page" hidden>
      <section class="card">
        <div class="animals-header">
          <h2>Animales</h2>
          <p class="muted">Gestiona todos los registros de animales</p>
        </div>

        <!-- Animals Section -->
        <div class="animals-dropdown">
          <div class="dropdown-header" onclick="toggleAnimalsDropdown()">
            <div class="dropdown-title">
              <span class="dropdown-icon">A</span>
              <span>Animales</span>
              <span class="dropdown-count" id="animals-count">0</span>
            </div>
            <div class="dropdown-arrow" id="animals-arrow">▼</div>
          </div>
          
          <div class="dropdown-content" id="animals-content">
            <!-- Summary Stats -->
            <div class="summary-section">
              <div class="summary-stats">
                <div class="summary-item">
                  <span class="label">Total:</span>
                  <span class="value" id="animals-total">0</span>
                </div>
                <div class="summary-item">
                  <span class="label">Pendientes:</span>
                  <span class="value pending" id="animals-pending">0</span>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="dropdown-actions">
              <button id="register-cow-btn" class="action-btn primary">
                <span class="action-icon">+</span>
                <span>Registrar Nuevo Animal</span>
              </button>
              <button id="manage-synced-cows" class="action-btn">
                <span class="action-icon">≡</span>
                <span>Gestionar registros…</span>
              </button>
              <button id="export-csv-cows" class="action-btn">
                <span class="action-icon">↓</span>
                <span>Exportar CSV</span>
              </button>
            </div>

            <!-- Registration Form (shown when registering) -->
            <div id="register-cow-section" class="registration-form" hidden>
              <form id="inline-add-cow" class="form-vertical">
                <input type="hidden" id="inline-animal-type" value="1">
                <div class="form-field">
                  <label for="inline-animal-cow">ID del animal (requerido)</label>
                  <input id="inline-animal-cow" type="text" placeholder="e.g., 123-45" autocomplete="off" required>
                </div>
                <div class="form-field">
                  <label for="inline-rp-animal-cow">RP Animal (opcional)</label>
                  <input id="inline-rp-animal-cow" type="text" placeholder="e.g., RP-12345" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-mother-cow">Madre ID (opcional)</label>
                  <input id="inline-mother-cow" type="text" placeholder="e.g., 67890" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-rp-mother-cow">RP Madre (opcional)</label>
                  <input id="inline-rp-mother-cow" type="text" placeholder="e.g., RP-67890" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-father-cow">Padre ID (opcional)</label>
                  <input id="inline-father-cow" type="text" placeholder="e.g., Repaso, 2399" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-born-cow">Nacimiento (opcional)</label>
                  <input id="inline-born-cow" type="date" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-weight-cow">Peso (kg, opcional)</label>
                  <input id="inline-weight-cow" type="number" step="0.01" min="0" placeholder="e.g., 250.5" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-mother-weight-cow">Peso de la Madre (kg, opcional)</label>
                  <input id="inline-mother-weight-cow" type="number" step="0.01" min="0" placeholder="e.g., 450.0" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-gender-cow">Sexo (opcional)</label>
                  <select id="inline-gender-cow">
                    <option value="">— Seleccionar —</option>
                    <option value="MALE">Macho</option>
                    <option value="FEMALE">Hembra</option>
                    <option value="UNKNOWN">Desconocido</option>
                  </select>
                </div>
                <div class="form-field" id="scrotal-circumference-field" style="display: none;">
                  <label for="inline-scrotal-circumference-cow">Circunferencia Escrotal (cm, opcional)</label>
                  <input id="inline-scrotal-circumference-cow" type="number" step="0.1" min="0" max="100" placeholder="e.g., 35.5" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-insemination-id-cow">ID de Inseminación (opcional)</label>
                  <select id="inline-insemination-id-cow">
                    <option value="">— Seleccionar —</option>
                  </select>
                </div>
                <div class="form-field">
                  <label for="inline-status-cow">Estado (opcional)</label>
                  <select id="inline-status-cow">
                    <option value="">— Seleccionar —</option>
                    <option value="ALIVE" selected>Vivo</option>
                    <option value="DEAD">Muerto</option>
                    <option value="UNKNOWN">Desconocido</option>
                  </select>
                </div>
                <div class="form-field">
                  <label for="inline-color-cow">Color (opcional)</label>
                  <select id="inline-color-cow">
                    <option value="">— Seleccionar —</option>
                    <option value="COLORADO">Colorado</option>
                    <option value="NEGRO">Negro</option>
                    <option value="OTHERS">Otros</option>
                  </select>
                </div>
                <div class="form-field">
                  <label for="inline-notes-mother-cow">Notas de la madre (opcional)</label>
                  <input id="inline-notes-mother-cow" type="text" placeholder="Cualquier nota sobre la madre" autocomplete="off">
                </div>
                <div class="form-field">
                  <label for="inline-notes-cow">Notas (opcional)</label>
                  <input id="inline-notes-cow" type="text" placeholder="Cualquier nota" autocomplete="off">
                </div>
                <div class="form-actions">
                  <button class="btn primary" id="inline-add-cow-btn" type="submit">Registrar Animal</button>
                  <button class="btn" type="button" id="cancel-registration">Cancelar</button>
                </div>
              </form>
            </div>

            <!-- Records List (Collapsible) -->
            <div class="records-list-section">
              <div class="records-list-header" onclick="toggleRecordsList()">
                <div class="records-list-title">
                  <span class="records-list-icon">📋</span>
                  <span>Registros Recientes</span>
                  <span class="records-list-count" id="records-count">0</span>
                </div>
                <div class="records-list-arrow" id="records-list-arrow">▼</div>
              </div>
              <div class="records-list-content" id="animals-records">
                <!-- Records will be populated here -->
              </div>
            </div>
          </div>
        </div>

        <!-- Inseminaciones Section -->
        <div class="animals-dropdown" style="opacity: 0.5;">
          <div class="dropdown-header disabled">
            <div class="dropdown-title">
              <span class="dropdown-icon">I</span>
              <span>Inseminaciones</span>
              <span class="dropdown-status">Próximamente</span>
            </div>
          </div>
        </div>

      </section>
    </div>

    <!-- Pigs Page -->
    <!--
    <div id="pigs-page" hidden>
      <section class="card">
        <div class="row space-between align-center">
          <h2>Cerdos</h2>
          <div class="row gap">
            <button id="register-pig-btn" class="btn primary">Registrar Nuevo Cerdo</button>
            <button id="manage-synced-pigs" class="btn">Gestionar registros…</button>
            <button id="export-csv-pigs" class="btn">Exportar CSV</button>
          </div>
        </div>

        <!-- Registration form -->
        <section id="register-pig-section" hidden>
          <form id="inline-add-pig" class="form-vertical" style="margin:8px 0 12px;">
            <input type="hidden" id="inline-animal-type-pig" value="2">
            <div class="form-field">
              <label for="inline-animal-pig">ID del Cerdo (requerido)</label>
              <input id="inline-animal-pig" type="text" placeholder="e.g., 123-45" autocomplete="off" required>
            </div>
            <div class="form-field">
              <label for="inline-mother-pig">Madre ID (opcional)</label>
              <input id="inline-mother-pig" type="text" placeholder="e.g., 67890" autocomplete="off">
            </div>
            <div class="form-field">
              <label for="inline-born-pig">Nacimiento (opcional)</label>
              <input id="inline-born-pig" type="date" autocomplete="off">
            </div>
            <div class="form-field">
              <label for="inline-weight-pig">Peso (kg, opcional)</label>
              <input id="inline-weight-pig" type="number" step="0.01" min="0" placeholder="e.g., 50.5" autocomplete="off">
            </div>
            <div class="form-field">
              <label for="inline-gender-pig">Sexo (opcional)</label>
              <select id="inline-gender-pig">
                <option value="">— Seleccionar —</option>
                <option value="MALE">Macho</option>
                <option value="FEMALE">Hembra</option>
                <option value="UNKNOWN">Desconocido</option>
              </select>
            </div>
            <div class="form-field">
              <label for="inline-status-pig">Estado (opcional)</label>
              <select id="inline-status-pig">
                <option value="">— Seleccionar —</option>
                <option value="ALIVE" selected>Vivo</option>
                <option value="DEAD">Muerto</option>
                <option value="UNKNOWN">Desconocido</option>
              </select>
            </div>
            <div class="form-field">
              <label for="inline-color-pig">Color (opcional)</label>
              <select id="inline-color-pig">
                <option value="">— Seleccionar —</option>
                <option value="ROSA">Rosa</option>
                <option value="NEGRO">Negro</option>
                <option value="BLANCO">Blanco</option>
                <option value="MARRON">Marrón</option>
                <option value="OTHERS">Otros</option>
              </select>
            </div>
            <div class="form-field">
              <label for="inline-notes-mother-pig">Notas de la madre (opcional)</label>
              <input id="inline-notes-mother-pig" type="text" placeholder="Cualquier nota sobre la madre" autocomplete="off">
            </div>
            <div class="form-field">
              <label for="inline-notes-pig">Notas (opcional)</label>
              <input id="inline-notes-pig" type="text" placeholder="Cualquier nota" autocomplete="off">
            </div>
            <div class="row gap">
              <button class="btn primary" id="inline-add-pig-btn" type="submit" aria-label="Registrar cerdo">Registrar Cerdo</button>
            </div>
          </form>
        </section>

        <ul id="pigs-records" class="list"></ul>
      </section>
    </div>
    -->

    <!-- Search Page -->
    <div id="search-page" hidden>
      <section class="card">
        <div class="row space-between align-center">
          <h2>Buscar Animales</h2>
        </div>

        <!-- Search interface -->
        <div id="search-interface-container"></div>

        <!-- Search results -->
        <div id="search-results-container"></div>
      </section>
    </div>

    <!-- Objectives Page -->
    <div id="objectives-page" hidden>
      <section class="card">
        <div class="row space-between align-center">
          <h2>Configuración</h2>
        </div>

        <!-- Objectives content will be rendered here -->
        <div id="objectives-container"></div>
      </section>
    </div>
  </main>

  <footer class="footer">
    <small>
      Status: <span id="sync-status">Idle</span>
      • API: <code id="api-base"></code>
    </small>
  </footer>


  <script type="module" src="app/main.js"></script>
  <div id="toast" role="status" aria-live="polite" hidden></div>
  <dialog id="manage-synced-dialog">
    <div class="row space-between align-center">
      <h3 style="margin:0;">Gestionar registros sincronizados</h3>
      <form method="dialog">
        <button class="btn" value="close">Cerrar</button>
      </form>
    </div>
    <ul id="manage-synced-list" class="list" style="margin-top:8px;"></ul>
  </dialog>
  <dialog id="export-dialog">
    <form method="dialog" class="form-vertical">
      <h3 style="margin:0 0 8px 0;">Exportar por fecha de nacimiento</h3>
      <div class="row gap" style="align-items:center;">
        <label class="muted" for="export-start-modal">Desde</label>
        <input id="export-start-modal" type="date" aria-label="Desde fecha de nacimiento" />
        <label class="muted" for="export-end-modal">Hasta</label>
        <input id="export-end-modal" type="date" aria-label="Hasta fecha de nacimiento" />
      </div>
      <div class="row gap" style="margin-top:12px; justify-content:flex-end;">
        <button class="btn" value="cancel" id="export-cancel">Cancelar</button>
        <button class="btn primary" value="confirm" id="export-confirm">Exportar</button>
      </div>
    </form>
  </dialog>
</body>
</html>

